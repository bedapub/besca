

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Annotate celltypes &mdash; BESCA 2.4.6+115.gb14a31c documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/plot_directive.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/sg_gallery.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/sg_gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/sg_gallery-dataframe.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/sg_gallery-rendered-html.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="tutorials" href="../../tutorials.html" />
    <link rel="prev" title="Workflows" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> BESCA
          

          
          </a>

          
            
            
              <div class="version">
                2.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../besca.html">besca</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">code examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#plotting-examples">Plotting examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#preprocessing">Preprocessing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#tools">Tools</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#workflows">Workflows</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../plotting/index.html">Plotting examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../preprocessing/index.html">Preprocessing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tools/index.html">Tools</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Workflows</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">Annotate celltypes</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#visualization-of-marker-genes">visualization of marker genes</a></li>
<li class="toctree-l5"><a class="reference internal" href="#cluster-level-celltype-annotation">cluster level celltype annotation</a></li>
<li class="toctree-l5"><a class="reference internal" href="#reclustering-on-mixed-cell-clusters">reclustering on mixed cell clusters</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials.html">tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../besca_standard_pipeline.html">standard pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../adding_new_functions.html">adding new functions to besca</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">BESCA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Code Examples</a> &raquo;</li>
        
          <li><a href="index.html">Workflows</a> &raquo;</li>
        
      <li>Annotate celltypes</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/auto_examples/workflows/plot_celltype_annotation.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-auto-examples-workflows-plot-celltype-annotation-py"><span class="std std-ref">here</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="annotate-celltypes">
<span id="sphx-glr-auto-examples-workflows-plot-celltype-annotation-py"></span><h1>Annotate celltypes<a class="headerlink" href="#annotate-celltypes" title="Permalink to this heading">Â¶</a></h1>
<p>An example workflow using the PBMC3k dataset included with besca illustrating how to annotate celltypes based on leiden clusters.
This workflow begins with a preprocessed and filtered dataset.
Please refer to other tutorials on how to perform these steps.</p>
<p>This shows how to dipslay diffrent markers genes, assign the clusters and if need be to recluster on mixed cluster.
For PBMC dataset we advised the user to work using the sig-annot or auto-annot procedures which is automated, less error-prone, and
allow for standardized annotations across datasets.</p>
<p>This is well illustrated in the tutorials (see Notebook 2 )</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>

<span class="c1"># load libraries</span>
<span class="kn">import</span> <span class="nn">besca</span> <span class="k">as</span> <span class="nn">bc</span>
<span class="kn">import</span> <span class="nn">scanpy</span> <span class="k">as</span> <span class="nn">sc</span>
<span class="kn">import</span> <span class="nn">pytest</span>

<span class="c1"># pytest.skip(&#39;Test is only for here as example and should not be executed&#39;)</span>
<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># load preprocessed dataset (included in BESCA for demonstration purposes)</span>
<span class="n">adata</span> <span class="o">=</span> <span class="n">bc</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">pbmc3k_filtered</span><span class="p">()</span>

<span class="c1"># need to drop celltype annotation stored in this dataset (only relevant for this tutorial)</span>
<span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;leiden&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">sc</span><span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">leiden</span><span class="p">(</span><span class="n">adata</span><span class="p">)</span>
<span class="c1"># visualize the leiden clusters</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;leiden&quot;</span><span class="p">])</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_celltype_annotation_001.png" srcset="../../_images/sphx_glr_plot_celltype_annotation_001.png" alt="leiden" class = "sphx-glr-single-img"/><section id="visualization-of-marker-genes">
<h2>visualization of marker genes<a class="headerlink" href="#visualization-of-marker-genes" title="Permalink to this heading">Â¶</a></h2>
<p>Depending on the type of data you are analysing you will need to look at
different marker genes that are specific to the celltypes you would expect
to find in your dataset. In this case we are looking at PBMC cells and will
try to identify the main Immunecell subtypes: T-cells, B-cells, Monocytes, and
Dendritic cells.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># identification of T-cells</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;CD3E&quot;</span><span class="p">,</span> <span class="s2">&quot;CD3G&quot;</span><span class="p">,</span> <span class="s2">&quot;CD3D&quot;</span><span class="p">])</span>

<span class="c1"># identification of NK cells</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;NCAM1&quot;</span><span class="p">,</span> <span class="s2">&quot;NKG7&quot;</span><span class="p">,</span> <span class="s2">&quot;GNLY&quot;</span><span class="p">])</span>

<span class="c1"># identification of B-cells</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;MS4A1&quot;</span><span class="p">,</span> <span class="s2">&quot;CD19&quot;</span><span class="p">,</span> <span class="s2">&quot;CD79A&quot;</span><span class="p">])</span>

<span class="c1"># identification of myeloid cells/dendritic cells</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;CST3&quot;</span><span class="p">,</span> <span class="s2">&quot;S100A8&quot;</span><span class="p">,</span> <span class="s2">&quot;S100A9&quot;</span><span class="p">])</span>

<span class="c1"># identification of dendritic cells(FCERIA) and monocytes</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;FCER1A&quot;</span><span class="p">,</span> <span class="s2">&quot;CD14&quot;</span><span class="p">,</span> <span class="s2">&quot;FCGR3A&quot;</span><span class="p">])</span>
</pre></div>
</div>
<ul class="sphx-glr-horizontal">
<li><img src="../../_images/sphx_glr_plot_celltype_annotation_002.png" srcset="../../_images/sphx_glr_plot_celltype_annotation_002.png" alt="CD3E, CD3G, CD3D" class = "sphx-glr-multi-img"/></li>
<li><img src="../../_images/sphx_glr_plot_celltype_annotation_003.png" srcset="../../_images/sphx_glr_plot_celltype_annotation_003.png" alt="NCAM1, NKG7, GNLY" class = "sphx-glr-multi-img"/></li>
<li><img src="../../_images/sphx_glr_plot_celltype_annotation_004.png" srcset="../../_images/sphx_glr_plot_celltype_annotation_004.png" alt="MS4A1, CD19, CD79A" class = "sphx-glr-multi-img"/></li>
<li><img src="../../_images/sphx_glr_plot_celltype_annotation_005.png" srcset="../../_images/sphx_glr_plot_celltype_annotation_005.png" alt="CST3, S100A8, S100A9" class = "sphx-glr-multi-img"/></li>
<li><img src="../../_images/sphx_glr_plot_celltype_annotation_006.png" srcset="../../_images/sphx_glr_plot_celltype_annotation_006.png" alt="FCER1A, CD14, FCGR3A" class = "sphx-glr-multi-img"/></li>
</ul>
</section>
<section id="cluster-level-celltype-annotation">
<h2>cluster level celltype annotation<a class="headerlink" href="#cluster-level-celltype-annotation" title="Permalink to this heading">Â¶</a></h2>
<p>Depending on how fine-grained your clustering is you will often come into the
the situation that a leiden cluster contains several cell-populations that
are clearly segregated based on the marker gene expression. If this happens you
can try and adjust the leiden resolution parameter to make the clustering more
fine-grained, but this will not always be successfull. Especially in cases where
your sample contains vastly different celltypes (e.g. an Immuncell dataset
containing B-cells and T-cells) it will be difficult to resolve T-cell subsets
since they are much more comparable to each other than e.g. a T-cell vs a B-cell.
In this case it often makes sense to make a highlevel cell-labeling and then perform
a second clustering on onoly the mixed cellclusters. This is the procedure that will
be demonstrated in the rest of this tutorial.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># define high-level celltype annotation</span>
<span class="n">new_labels</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Tcells&quot;</span><span class="p">,</span>  <span class="c1"># 0</span>
    <span class="s2">&quot;CD14+ monocyte&quot;</span><span class="p">,</span>  <span class="c1"># 1</span>
    <span class="s2">&quot;mixed&quot;</span><span class="p">,</span>  <span class="c1"># 2</span>
    <span class="s2">&quot;Bcells&quot;</span><span class="p">,</span>  <span class="c1"># 3</span>
    <span class="s2">&quot;Tcells&quot;</span><span class="p">,</span>  <span class="c1"># 4</span>
    <span class="s2">&quot;FCGR3A+ monocyte&quot;</span><span class="p">,</span>  <span class="c1"># 5</span>
    <span class="s2">&quot;pDC&quot;</span><span class="p">,</span>  <span class="c1"># 6</span>
<span class="p">]</span>  <span class="c1"># 7</span>

<span class="n">bc</span><span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">annotate_cells_clustering</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">new_labels</span><span class="p">)</span>  <span class="c1"># ISSUE is in this method</span>

<span class="c1"># visualize annotation</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;celltype&quot;</span><span class="p">])</span>

<span class="c1"># preserve highlevel labels for future use if desired</span>
<span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s2">&quot;high_level celltype&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">celltype</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_celltype_annotation_007.png" srcset="../../_images/sphx_glr_plot_celltype_annotation_007.png" alt="celltype" class = "sphx-glr-single-img"/></section>
<section id="reclustering-on-mixed-cell-clusters">
<h2>reclustering on mixed cell clusters<a class="headerlink" href="#reclustering-on-mixed-cell-clusters" title="Permalink to this heading">Â¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># perform reclustering on subset using besca function</span>
<span class="n">adata_subset</span> <span class="o">=</span> <span class="n">bc</span><span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">rc</span><span class="o">.</span><span class="n">recluster</span><span class="p">(</span>
    <span class="n">adata</span><span class="p">,</span> <span class="n">celltype</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;mixed&quot;</span><span class="p">,</span> <span class="s2">&quot;Tcells&quot;</span><span class="p">),</span> <span class="n">celltype_label</span><span class="o">=</span><span class="s2">&quot;celltype&quot;</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mf">1.3</span>
<span class="p">)</span>

<span class="c1"># visualize important marker genes in reclustering</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span>
    <span class="n">adata_subset</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;leiden&quot;</span><span class="p">,</span> <span class="s2">&quot;CD3G&quot;</span><span class="p">,</span> <span class="s2">&quot;CD8A&quot;</span><span class="p">,</span> <span class="s2">&quot;CD4&quot;</span><span class="p">,</span> <span class="s2">&quot;IL7R&quot;</span><span class="p">,</span> <span class="s2">&quot;NKG7&quot;</span><span class="p">,</span> <span class="s2">&quot;GNLY&quot;</span><span class="p">],</span>
    <span class="n">ncols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">adata_subset</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;leiden&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

<span class="c1"># annotate celltypes based on the new leiden clusters</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;NK cell&quot;</span><span class="p">,</span>  <span class="c1"># 0</span>
    <span class="s2">&quot;CD4 T-cell&quot;</span><span class="p">,</span>  <span class="c1"># 1</span>
    <span class="s2">&quot;CD4 T-cell&quot;</span><span class="p">,</span>  <span class="c1"># 2</span>
    <span class="s2">&quot;CD4 T-cell&quot;</span><span class="p">,</span>  <span class="c1"># 3</span>
    <span class="s2">&quot;CD4 T-cell&quot;</span><span class="p">,</span>  <span class="c1"># 4</span>
    <span class="s2">&quot;CD8 T-cell&quot;</span><span class="p">,</span>  <span class="c1"># 5</span>
    <span class="s2">&quot;CD4 T-cell&quot;</span><span class="p">,</span>  <span class="c1"># 6</span>
    <span class="s2">&quot;CD8 T-cell&quot;</span><span class="p">,</span>  <span class="c1"># 7</span>
    <span class="s2">&quot;CD4 T-cell&quot;</span><span class="p">,</span>  <span class="c1"># 8</span>
    <span class="s2">&quot;CD4 T-cell&quot;</span><span class="p">,</span>  <span class="c1"># 9</span>
    <span class="s2">&quot;CD4 T-cell&quot;</span><span class="p">,</span>  <span class="c1"># 10</span>
    <span class="s2">&quot;CD4 T-cell&quot;</span><span class="p">,</span>  <span class="c1"># 11</span>
    <span class="s2">&quot;CD4 T-cell&quot;</span><span class="p">,</span>  <span class="c1"># 12</span>
    <span class="s2">&quot;CD4 T-cell&quot;</span><span class="p">,</span>  <span class="c1"># 13</span>
    <span class="s2">&quot;CD4 T-cell&quot;</span><span class="p">,</span>  <span class="c1"># 14</span>
    <span class="s2">&quot;CD4 T-cell&quot;</span><span class="p">,</span>  <span class="c1"># 15</span>
    <span class="s2">&quot;CD4 T-cell&quot;</span><span class="p">,</span>  <span class="c1"># 16</span>
    <span class="s2">&quot;CD4 T-cell&quot;</span><span class="p">,</span>  <span class="c1"># 17</span>
    <span class="s2">&quot;CD4 T-cell&quot;</span><span class="p">,</span>  <span class="c1"># 18</span>
    <span class="s2">&quot;CD4 T-cell&quot;</span><span class="p">,</span>  <span class="c1"># 19</span>
    <span class="s2">&quot;NK cell&quot;</span><span class="p">,</span>  <span class="c1"># 20</span>
<span class="p">]</span>

<span class="n">new_labels</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">adata_subset</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;leiden&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span>
<span class="p">]</span>

<span class="c1"># merge new celllabels back into the original adata object containing all cells</span>
<span class="c1"># Note: this will overwrite the labels contained in adata.obs.celltype! If you w</span>
<span class="n">bc</span><span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">rc</span><span class="o">.</span><span class="n">annotate_new_cellnames</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">adata_subset</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">new_labels</span><span class="p">)</span>

<span class="c1"># visualize finished celltype annotation</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;celltype&quot;</span><span class="p">])</span>
</pre></div>
</div>
<ul class="sphx-glr-horizontal">
<li><img src="../../_images/sphx_glr_plot_celltype_annotation_008.png" srcset="../../_images/sphx_glr_plot_celltype_annotation_008.png" alt="leiden, CD3G, CD8A, CD4, IL7R, NKG7, GNLY" class = "sphx-glr-multi-img"/></li>
<li><img src="../../_images/sphx_glr_plot_celltype_annotation_009.png" srcset="../../_images/sphx_glr_plot_celltype_annotation_009.png" alt="celltype" class = "sphx-glr-multi-img"/></li>
</ul>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[&#39;0&#39;, &#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;, &#39;7&#39;]
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  3.793 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-workflows-plot-celltype-annotation-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/a7cb7cbb3c4e4c760e0bf9c362ac5bd4/plot_celltype_annotation.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_celltype_annotation.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/509f3cf430c489fdc5db6d1c1207ce93/plot_celltype_annotation.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_celltype_annotation.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../../tutorials.html" class="btn btn-neutral float-right" title="tutorials" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="index.html" class="btn btn-neutral float-left" title="Workflows" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2022, Roche Pharma Research and Early Development,     Pharmaceutical Sciences, Roche Innovation Center Basel, Basel, Switzerland.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>